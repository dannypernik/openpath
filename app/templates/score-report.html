{% extends 'base.html' %}

{% block head %}
  {{ super() }}

  <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
{% endblock head %}

{% block container %}
  <div class="row section-margin justify-content-center">
    <div class="col-12 col-sm-10 col-lg-9">
      <h1>Bluebook practice SAT<sup class="h5">&#174;</sup> score analysis</h1>
      <p>
        Upload your results from a practice test to get a more detailed score analysis than the College Board provides.
      </p>

      <form id="score-report-form" action="" method="post" enctype="multipart/form-data">
        <div class="row justify-content-center mt-3">
          <div class="col-12 col-lg-6">
            {{ form.hidden_tag() }}
            {{ form.first_name }}
          </div>
          <div class="col-12 col-lg-6">
            {{ form.last_name }}
          </div>
          <div class="col-12 col-lg-6">
            {{ form.email }}
          </div>
          <div class="col-12 col-lg-6 position-relative">
            {{ form.spreadsheet_url }}
            <a id="ss-icon" class="info-icon position-absolute" href="#" data-bs-toggle="modal" data-bs-target="#spreadsheet-modal">
              <svg
                width="18"
                height="18"
                version="1.1"
                viewBox="0 0 2.2316 2.2316"
                xml:space="preserve"
                id="svg1"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:svg="http://www.w3.org/2000/svg">
              <path
                d="M 1.115808,0 A 1.1158076,1.1158 0 0 0 0,1.1158 1.1158076,1.1158 0 0 0 1.115808,2.2316 1.1158076,1.1158 0 0 0 2.2316,1.1158 1.1158076,1.1158 0 0 0 1.115808,0 Z m 0.164048,0.26635 c 0.05824,0 0.108,0.01944 0.14928,0.05821 0.04144,0.03886 0.06192,0.08565 0.06192,0.140192 0,0.05466 -0.02064,0.101344 -0.06192,0.139728 -0.04128,0.03853 -0.09104,0.05779 -0.14928,0.05779 -0.0584,0 -0.10832,-0.01928 -0.15008,-0.05779 -0.0416,-0.0384 -0.06256,-0.08507 -0.06256,-0.139728 0,-0.05456 0.02096,-0.101312 0.06256,-0.140192 0.04176,-0.03882 0.09168,-0.05821 0.15008,-0.05821 z M 1.082928,0.841152 c 0.0856,0 0.15168,0.02069 0.19808,0.06208 0.0464,0.04141 0.0696,0.0951 0.0696,0.161259 0,0.01376 -0.00152,0.03781 -0.0048,0.07227 -0.0032,0.03454 -0.0096,0.06621 -0.01776,0.09499 l -0.08864,0.313735 c -0.008,0.0252 -0.0144,0.054 -0.01952,0.08643 -0.0064,0.03221 -0.008,0.05682 -0.008,0.07331 0,0.04166 0.0096,0.0701 0.02784,0.08522 0.01872,0.01504 0.05104,0.02264 0.09696,0.02264 0.0216,0 0.04608,-0.0038 0.07328,-0.01136 0.0272,-0.0075 0.04704,-0.01408 0.0592,-0.01987 l -0.02368,0.09704 c -0.0712,0.02811 -0.12816,0.04949 -0.170464,0.06421 -0.0424,0.01472 -0.09168,0.0221 -0.14784,0.0221 -0.08624,0 -0.15328,-0.02112 -0.201088,-0.06307 -0.04784,-0.04211 -0.07168,-0.09549 -0.07168,-0.160224 0,-0.02506 0.0016,-0.05083 0.0048,-0.0771 0.0032,-0.02629 0.0096,-0.05592 0.01728,-0.08901 l 0.08896,-0.314997 c 0.008,-0.03016 0.0144,-0.05875 0.02,-0.08578 0.0048,-0.02686 0.008,-0.05157 0.008,-0.07381 0,-0.04022 -0.008,-0.06837 -0.02496,-0.08419 -0.01664,-0.01584 -0.04816,-0.02378 -0.0952,-0.02378 -0.02304,0 -0.04672,0.0037 -0.07072,0.01088 -0.02416,0.0072 -0.04496,0.01408 -0.06224,0.0205 l 0.02384,-0.09712 c 0.05824,-0.02374 0.11408,-0.04406 0.167328,-0.06093 0.05328,-0.01691 0.10368,-0.02539 0.15136,-0.02539 z"
                stroke-width="0.0217687"
                id="path1" />
              </svg>
              <span>Instructions</span>
            </a>
          </div>
          <div class="col-12 col-lg-6">
            {{ form.report_file.label(class='mt-2') }}
            <a class="info-icon" href="#" data-bs-toggle="modal" data-bs-target="#report-modal" title="Instructions">
              <svg
                width="18"
                height="18"
                version="1.1"
                viewBox="0 0 2.2316 2.2316"
                xml:space="preserve"
                id="svg1"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:svg="http://www.w3.org/2000/svg">
              <path
                d="M 1.115808,0 A 1.1158076,1.1158 0 0 0 0,1.1158 1.1158076,1.1158 0 0 0 1.115808,2.2316 1.1158076,1.1158 0 0 0 2.2316,1.1158 1.1158076,1.1158 0 0 0 1.115808,0 Z m 0.164048,0.26635 c 0.05824,0 0.108,0.01944 0.14928,0.05821 0.04144,0.03886 0.06192,0.08565 0.06192,0.140192 0,0.05466 -0.02064,0.101344 -0.06192,0.139728 -0.04128,0.03853 -0.09104,0.05779 -0.14928,0.05779 -0.0584,0 -0.10832,-0.01928 -0.15008,-0.05779 -0.0416,-0.0384 -0.06256,-0.08507 -0.06256,-0.139728 0,-0.05456 0.02096,-0.101312 0.06256,-0.140192 0.04176,-0.03882 0.09168,-0.05821 0.15008,-0.05821 z M 1.082928,0.841152 c 0.0856,0 0.15168,0.02069 0.19808,0.06208 0.0464,0.04141 0.0696,0.0951 0.0696,0.161259 0,0.01376 -0.00152,0.03781 -0.0048,0.07227 -0.0032,0.03454 -0.0096,0.06621 -0.01776,0.09499 l -0.08864,0.313735 c -0.008,0.0252 -0.0144,0.054 -0.01952,0.08643 -0.0064,0.03221 -0.008,0.05682 -0.008,0.07331 0,0.04166 0.0096,0.0701 0.02784,0.08522 0.01872,0.01504 0.05104,0.02264 0.09696,0.02264 0.0216,0 0.04608,-0.0038 0.07328,-0.01136 0.0272,-0.0075 0.04704,-0.01408 0.0592,-0.01987 l -0.02368,0.09704 c -0.0712,0.02811 -0.12816,0.04949 -0.170464,0.06421 -0.0424,0.01472 -0.09168,0.0221 -0.14784,0.0221 -0.08624,0 -0.15328,-0.02112 -0.201088,-0.06307 -0.04784,-0.04211 -0.07168,-0.09549 -0.07168,-0.160224 0,-0.02506 0.0016,-0.05083 0.0048,-0.0771 0.0032,-0.02629 0.0096,-0.05592 0.01728,-0.08901 l 0.08896,-0.314997 c 0.008,-0.03016 0.0144,-0.05875 0.02,-0.08578 0.0048,-0.02686 0.008,-0.05157 0.008,-0.07381 0,-0.04022 -0.008,-0.06837 -0.02496,-0.08419 -0.01664,-0.01584 -0.04816,-0.02378 -0.0952,-0.02378 -0.02304,0 -0.04672,0.0037 -0.07072,0.01088 -0.02416,0.0072 -0.04496,0.01408 -0.06224,0.0205 l 0.02384,-0.09712 c 0.05824,-0.02374 0.11408,-0.04406 0.167328,-0.06093 0.05328,-0.01691 0.10368,-0.02539 0.15136,-0.02539 z"
                stroke-width="0.0217687"
                id="path1" />
              </svg>
              <span>Instructions</span>
            </a>
            {{ form.report_file(accept='.pdf') }}
          </div>
          <div class="col-12 col-lg-6">
            {{ form.details_file.label(class='mt-2') }}
            <a class="info-icon" href="#" data-bs-toggle="modal" data-bs-target="#details-modal">
              <svg
                width="18"
                height="18"
                version="1.1"
                viewBox="0 0 2.2316 2.2316"
                xml:space="preserve"
                id="svg1"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:svg="http://www.w3.org/2000/svg">
              <path
                d="M 1.115808,0 A 1.1158076,1.1158 0 0 0 0,1.1158 1.1158076,1.1158 0 0 0 1.115808,2.2316 1.1158076,1.1158 0 0 0 2.2316,1.1158 1.1158076,1.1158 0 0 0 1.115808,0 Z m 0.164048,0.26635 c 0.05824,0 0.108,0.01944 0.14928,0.05821 0.04144,0.03886 0.06192,0.08565 0.06192,0.140192 0,0.05466 -0.02064,0.101344 -0.06192,0.139728 -0.04128,0.03853 -0.09104,0.05779 -0.14928,0.05779 -0.0584,0 -0.10832,-0.01928 -0.15008,-0.05779 -0.0416,-0.0384 -0.06256,-0.08507 -0.06256,-0.139728 0,-0.05456 0.02096,-0.101312 0.06256,-0.140192 0.04176,-0.03882 0.09168,-0.05821 0.15008,-0.05821 z M 1.082928,0.841152 c 0.0856,0 0.15168,0.02069 0.19808,0.06208 0.0464,0.04141 0.0696,0.0951 0.0696,0.161259 0,0.01376 -0.00152,0.03781 -0.0048,0.07227 -0.0032,0.03454 -0.0096,0.06621 -0.01776,0.09499 l -0.08864,0.313735 c -0.008,0.0252 -0.0144,0.054 -0.01952,0.08643 -0.0064,0.03221 -0.008,0.05682 -0.008,0.07331 0,0.04166 0.0096,0.0701 0.02784,0.08522 0.01872,0.01504 0.05104,0.02264 0.09696,0.02264 0.0216,0 0.04608,-0.0038 0.07328,-0.01136 0.0272,-0.0075 0.04704,-0.01408 0.0592,-0.01987 l -0.02368,0.09704 c -0.0712,0.02811 -0.12816,0.04949 -0.170464,0.06421 -0.0424,0.01472 -0.09168,0.0221 -0.14784,0.0221 -0.08624,0 -0.15328,-0.02112 -0.201088,-0.06307 -0.04784,-0.04211 -0.07168,-0.09549 -0.07168,-0.160224 0,-0.02506 0.0016,-0.05083 0.0048,-0.0771 0.0032,-0.02629 0.0096,-0.05592 0.01728,-0.08901 l 0.08896,-0.314997 c 0.008,-0.03016 0.0144,-0.05875 0.02,-0.08578 0.0048,-0.02686 0.008,-0.05157 0.008,-0.07381 0,-0.04022 -0.008,-0.06837 -0.02496,-0.08419 -0.01664,-0.01584 -0.04816,-0.02378 -0.0952,-0.02378 -0.02304,0 -0.04672,0.0037 -0.07072,0.01088 -0.02416,0.0072 -0.04496,0.01408 -0.06224,0.0205 l 0.02384,-0.09712 c 0.05824,-0.02374 0.11408,-0.04406 0.167328,-0.06093 0.05328,-0.01691 0.10368,-0.02539 0.15136,-0.02539 z"
                stroke-width="0.0217687"
                id="path1" />
              </svg>
              <span>Instructions</span>
            </a>
            {{ form.details_file(accept='.pdf') }}
          </div>
          <div class="col-12 text-center mt-2">
            <div class="h-captcha" data-sitekey="{{ hcaptcha_key }}" data-callback="captchaPassed"></div>
            <input id="submit" disabled name="submit" type="submit" value="Submit">
          </div>
        </div>
      </form>

      <div id="report-modal" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="container-fluid">
              <div class="row">
                <div class="modal-header mt-2">
                  <h2 class="modal-title">Score report instructions</h2>
                  <span type="button" class="btn-close" data-bs-dismiss="modal">&times;</span>
                </div>
              </div>
              <div class="modal-body">
                <div class="row">
                  <ol class="mb-3">
                    <li>Log in at <strong><a href="https://mypractice.collegeboard.org" target="_blank">mypractice.collegeboard.org</a></strong></li>
                    <li>Click on the "Score Details" button for the test you want to analyze</li>
                    <li>Click "Download Score Report" at top of the page</li>
                  </ol>
                  <video src="{{ url_for('static', filename='media/report.webm') }}" controls></video>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="details-modal" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="container-fluid">
              <div class="row">
                <div class="modal-header mt-2">
                  <h2 class="modal-title">Score details instructions</h2>
                  <span type="button" class="btn-close" data-bs-dismiss="modal">&times;</span>
                </div>
              </div>
              <div class="modal-body">
                <div class="row">
                  <ol class="mb-3">
                    <li>Scroll down to answers table and click "All" to show all answers</li>
                    <li>Ensure that the window is wide enough that "Reading and Writing" displays on one line</li>
                    <li>Click "File > Print..." in your browser</li>
                    <li>Set the destination to "Save as PDF", then Save</li>
                  </ol>
                  <video src="{{ url_for('static', filename='media/details.webm') }}" class="mb-3" controls></video>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="spreadsheet-modal" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="container-fluid">
              <div class="row">
                <div class="modal-header mt-2">
                  <h2 class="modal-title">Student spreadsheet instructions</h2>
                  <span type="button" class="btn-close" data-bs-dismiss="modal">&times;</span>
                </div>
              </div>
              <div class="modal-body">
                <div class="row">
                  <p>
                    If you use the SAT Answer Analysis Google Sheet to track your
                    progress, you can include a link to your spreadsheet to automatically
                    add your practice test answers. Here's how to grant access:
                  </p>
                  <ol class="mb-3">
                    <li>
                      Click "Share" on your copy of the
                      <a href="https://docs.google.com/spreadsheets/d/1PmQWn8DWvjC7R7YfvU8EgeMbXj6P6_X27awzWByJRKs/edit?usp=sharing" target="_blank">
                        SAT Answer Analysis Google Sheet
                      </a>
                    </li>
                    <li>
                      Add
                      <a id="service-email" href="#">
                        score-reports@sat-score-reports.iam.gserviceaccount.com
                        <svg id="copy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#f06d53" class="bi bi-copy" viewBox="0 0 16 16">
                          <path fill-rule="evenodd" d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z"/>
                        </svg>
                        <svg id="copy-check" class="d-none" width="18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 256 256" enable-background="new 0 0 256 256" xml:space="preserve">
                          <g><g><path fill="#f06d53" d="M95.8,224.6L10,138.7l42.9-42.9l42.9,42.9L203.1,31.4L246,74.4L95.8,224.6z"/></g></g>
                          </svg>
                      </a>
                      as an Editor
                    </li>
                    <li>Copy + paste the Google Sheet URL</li>
                  </ol>
                  <video src="{{ url_for('static', filename='media/spreadsheet.webm') }}" controls></video>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="loading-screen">
        <div class="loader">
          <div class="loading">
          </div>
        </div>
        <div class="loading-message">Verifying your uploaded files...</div>
      </div>
    </div>
  </div>
{% endblock container %}

{% block footnote %}
  {% include "_disclaimer.html" %}
{% endblock footnote %}

{% block end_scripts %}
  <script src="{{ url_for('static', filename='js/bootstrap.js') }}"></script>

  <script>

    document.getElementById('service-email').addEventListener('click', function(event) {
      event.preventDefault();
      var emailText = this.innerText;
      navigator.clipboard.writeText(emailText);
      document.getElementById('copy-icon').classList.add('d-none');
      document.getElementById('copy-check').classList.remove('d-none');
      setTimeout(function() {
        document.getElementById('copy-icon').classList.remove('d-none');
        document.getElementById('copy-check').classList.add('d-none');
      }, 1000);
    });

    function checkFormCompletion() {
      var form = document.querySelector('form');
      var isFormComplete = true;
      console.log('checking form completion')
      form.querySelectorAll('input').forEach(function(input) {
        if (input.hasAttribute('required') && (input.value === '' || (input.type === 'file' && input.files.length === 0))) {
          isFormComplete = false;
          console.log(input.name + ' is empty');
        }
      });

      if (isFormComplete && isCaptchaPassed) {
        form.querySelector('input[type=submit]').disabled = false;
      } else {
        form.querySelector('input[type=submit]').disabled = true;
      }
    }

    document.querySelectorAll('input').forEach(function(input) {
      input.addEventListener('input', checkFormCompletion);
    });

    var isCaptchaPassed = false;
    function captchaPassed(response) {
      isCaptchaPassed = true;
      checkFormCompletion();
      console.log(response)
      return response
    }

    // Disable submit button on form submit and show loading screen
    const form = document.querySelector('form');
    const submitButton = form.querySelector('input[type=submit]');
    form.addEventListener('submit', function() {
      window.setTimeout('this.disabled=true',0);
      document.querySelector('.loading-screen').style.display = 'block';
    });
  </script>

  <script src="https://unpkg.com/bowser"></script>
  <script>
    var browser = bowser.getParser(window.navigator.userAgent);
    var browserName = browser.getBrowserName().toLowerCase();
    var isChrome = browser.isBrowser('Chrome');
    var isFirefox = browser.isBrowser('Firefox');
    var isSafari = browser.isBrowser('Safari');
    var isEdge = browser.isBrowser('Microsoft Edge');
    var isIE = browser.isBrowser('Internet Explorer');

    // Use the browser variables to conditionally execute code or display messages
    if (isChrome) {
      // Code for Chrome browser
    } else if (isFirefox) {
      // Code for Firefox browser
    } else if (isSafari) {
      // Code for Safari browser
    } else if (isEdge) {
      // Code for Microsoft Edge browser
    } else if (isIE) {
      // Code for Internet Explorer browser
    } else {
      // Code for other browsers
    }
  </script>
{% endblock end_scripts %}